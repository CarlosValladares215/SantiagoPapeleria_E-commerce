<!-- Header Principal -->
<header class="header" id="mainHeader">
  <!-- Top Bar (Coreano Style) -->
  <div class="header-top-bar">
    <div class="header-container">
      <div class="top-bar-content">
        <span class="top-bar-text">

        </span>
        <div class="top-bar-links">
          <a routerLink="/sucursales"><i class="fas fa-store"></i> Sucursales</a>
          <a routerLink="/contact"><i class="fas fa-headset"></i> Ayuda</a>
          <a routerLink="/tracking"><i class="fas fa-map-marker-alt"></i> Seguimiento</a>
        </div>
      </div>
    </div>
  </div>

  <!-- Main Header -->
  <div class="bg-white">
    <div class="header-container">
      <div class="header-main">
        <!-- Logo y Menú Hamburguesa -->
        <div class="header-left">
          <button class="menu-hamburger" (click)="toggleMobileMenu()" aria-label="Menú principal">
            <span class="hamburger-line"></span>
            <span class="hamburger-line"></span>
            <span class="hamburger-line"></span>
          </button>

          <a routerLink="/" class="logo" aria-label="Santiago Papelería">
            <div class="logo-container">
              <img src="favicon.ico" alt="Santiago Papelería" class="logo-image" loading="eager">
              <div class="logo-text">
                <span class="logo-title">SANTIAGO</span>
                <span class="logo-subtitle">PAPELERÍA</span>
              </div>
            </div>
          </a>
        </div>

        <!-- Búsqueda (Estilo Coreano) -->
        <div class="header-center">
          <form class="search-container" (submit)="performSearch()" role="search" autocomplete="off">
            <div class="search-input-wrapper">
              <button type="submit" class="search-submit" aria-label="Buscar">
                <i class="fas fa-search"></i>
              </button>
              <input type="search" class="search-input" [(ngModel)]="searchQuery" name="search"
                placeholder="¿Qué producto buscas hoy?" aria-label="Buscar productos">
              <!-- Suggestions could go here -->
            </div>
          </form>
        </div>

        <!-- Acciones de Usuario -->
        <div class="header-right">
          <!-- Wishlist -->
          <button class="header-action-btn" aria-label="Lista de deseos" data-badge="3">
            <i class="far fa-heart"></i>
          </button>

          <!-- Carrito -->
          <button class="header-action-btn cart-btn" aria-label="Carrito de compras" (click)="toggleCart()">
            <i class="fas fa-shopping-bag"></i>
          </button>

          <!-- Usuario -->
          <div class="user-dropdown">
            <button class="header-action-btn user-btn" aria-label="Mi cuenta" (click)="toggleProfileMenu()">
              <i class="far fa-user"></i>
            </button>
            <div class="dropdown-content" [class.show]="isProfileMenuOpen()">
              <ng-container *ngIf="auth.user(); else guestMenu">
                <a (click)="goToProfile()"><i class="fas fa-user-circle"></i> Mi Perfil</a>
                <a routerLink="/pedidos"><i class="fas fa-box"></i> Mis Pedidos</a>
                <div class="dropdown-divider"></div>
                <a (click)="logout()" class="login-btn"><i class="fas fa-sign-out-alt"></i> Cerrar Sesión</a>
              </ng-container>
              <ng-template #guestMenu>
                <a routerLink="/login" class="login-btn"><i class="fas fa-sign-in-alt"></i> Iniciar Sesión</a>
                <a routerLink="/register" class="register-btn"><i class="fas fa-user-plus"></i> Registrarse</a>
              </ng-template>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Navegación Principal (3 MEGAS) -->
  <nav class="header-navigation" aria-label="Navegación principal">
    <div class="header-container">
      <ul class="nav-list">
        <li class="nav-item">
          <a routerLink="/" class="nav-link active">
            <i class="fas fa-home"></i>
            <span>INICIO</span>
          </a>
        </li>

        <!-- MEGA 1: Papelería & Oficina -->
        <li class="nav-item mega-parent" (mouseenter)="openMega('papeleria')" (mouseleave)="scheduleCloseMega()"
          (mouseenter)="cancelCloseMega()">
          <a [routerLink]="['/products']" [queryParams]="{categoria: 'papeleria-oficina'}" class="nav-link"
            [class.active]="megaMenu() === 'papeleria'">
            <i class="fas fa-pen-nib"></i>
            <span>PAPELERÍA & OFICINA</span>
            <i class="fas fa-chevron-down arrow"></i>
          </a>
        </li>

        <!-- MEGA 2: Hogar & Lifestyle -->
        <li class="nav-item mega-parent" (mouseenter)="openMega('hogar')" (mouseleave)="scheduleCloseMega()"
          (mouseenter)="cancelCloseMega()">
          <a [routerLink]="['/products']" [queryParams]="{categoria: 'hogar-lifestyle'}" class="nav-link"
            [class.active]="megaMenu() === 'hogar'">
            <i class="fas fa-store"></i>
            <span>HOGAR & LIFESTYLE</span>
            <i class="fas fa-chevron-down arrow"></i>
          </a>
        </li>

        <!-- MEGA 3: Creatividad & Regalos -->
        <li class="nav-item mega-parent" (mouseenter)="openMega('creatividad')" (mouseleave)="scheduleCloseMega()"
          (mouseenter)="cancelCloseMega()">
          <a [routerLink]="['/products']" [queryParams]="{categoria: 'creatividad-regalos'}" class="nav-link"
            [class.active]="megaMenu() === 'creatividad'">
            <i class="fas fa-palette"></i>
            <span>CREATIVIDAD & REGALOS</span>
            <i class="fas fa-chevron-down arrow"></i>
          </a>
        </li>

        <li class="nav-item">
          <a [routerLink]="['/offers']" class="nav-link highlight">
            <i class="fas fa-tag"></i>
            <span>OFERTAS ESPECIALES</span>
            <span class="badge">50%</span>
          </a>
        </li>

        <li class="nav-item">
          <a [routerLink]="['/products']" [queryParams]="{sort: 'newest'}" class="nav-link">
            <i class="fas fa-star"></i>
            <span>NUEVO</span>
            <span class="badge new">NUEVO</span>
          </a>
        </li>
      </ul>
    </div>
  </nav>

  <!-- MEGA MENÚS DESPLEGABLES -->
  <div class="mega-menu-container" (mouseenter)="cancelCloseMega()" (mouseleave)="scheduleCloseMega()">

    <!-- MEGA 1: Papelería & Oficina -->
    <div class="mega-menu" [class.active]="megaMenu() === 'papeleria'">
      <div class="mega-content">
        <div class="mega-grid" style="grid-template-columns: repeat(4, 1fr);">
          <!-- Columna 1: Escolar -->
          <div class="mega-section">
            <h3 class="mega-title"><i class="fas fa-graduation-cap"></i> ESCOLAR</h3>
            <ul class="mega-list">
              <li><a [routerLink]="['/products']" [queryParams]="{categoria: 'utiles-escolares'}">Útiles escolares</a>
              </li>
              <li><a [routerLink]="['/products']" [queryParams]="{categoria: 'cuadernos'}">Cuadernos</a></li>
              <li><a [routerLink]="['/products']" [queryParams]="{categoria: 'libretas'}">Libretas</a></li>
              <li><a [routerLink]="['/products']" [queryParams]="{categoria: 'forros'}">Forros</a></li>
              <li><a [routerLink]="['/products']" [queryParams]="{categoria: 'mochilas'}">Mochilas</a></li>
              <li><a [routerLink]="['/products']" [queryParams]="{categoria: 'cartucheras'}">Cartucheras</a></li>
              <li><a [routerLink]="['/products']" [queryParams]="{categoria: 'materiales-dibujo'}">Materiales de
                  dibujo</a></li>
            </ul>
          </div>

          <!-- Columna 2: Oficina -->
          <div class="mega-section">
            <h3 class="mega-title"><i class="fas fa-briefcase"></i> OFICINA</h3>
            <ul class="mega-list">
              <li><a [routerLink]="['/products']" [queryParams]="{categoria: 'suministros-oficina'}">Suministros de
                  oficina</a></li>
              <li><a [routerLink]="['/products']" [queryParams]="{categoria: 'accesorios-oficina'}">Accesorios de
                  oficina</a></li>
              <li><a [routerLink]="['/products']" [queryParams]="{categoria: 'carpetas'}">Carpetas</a></li>
              <li><a [routerLink]="['/products']" [queryParams]="{categoria: 'sellos'}">Sellos</a></li>
              <li><a [routerLink]="['/products']" [queryParams]="{categoria: 'papeleria-especializada'}">Papelería
                  especializada</a></li>
            </ul>
          </div>

          <!-- Columna 3: Tecnología -->
          <div class="mega-section">
            <h3 class="mega-title"><i class="fas fa-calculator"></i> TECNOLOGÍA</h3>
            <ul class="mega-list">
              <li><a [routerLink]="['/products']" [queryParams]="{categoria: 'calculadoras'}">Calculadoras</a></li>
              <li><a [routerLink]="['/products']" [queryParams]="{categoria: 'sumadoras'}">Sumadoras</a></li>
              <li><a [routerLink]="['/products']" [queryParams]="{categoria: 'tecnologia-oficina'}">Tecnología de
                  oficina</a></li>
            </ul>
          </div>

          <!-- Columna 4: Papeles -->
          <div class="mega-section">
            <h3 class="mega-title"><i class="fas fa-scroll"></i> PAPELES</h3>
            <ul class="mega-list">
              <li><a [routerLink]="['/products']" [queryParams]="{categoria: 'carton'}">Cartón</a></li>
              <li><a [routerLink]="['/products']" [queryParams]="{categoria: 'cartulina'}">Cartulina</a></li>
              <li><a [routerLink]="['/products']" [queryParams]="{categoria: 'papel-bond'}">Papel bond</a></li>
              <li><a [routerLink]="['/products']" [queryParams]="{categoria: 'papel-especial'}">Papel especial</a></li>
            </ul>
          </div>
        </div>
      </div>
    </div>

    <!-- MEGA 2: Hogar & Lifestyle -->
    <div class="mega-menu" [class.active]="megaMenu() === 'hogar'">
      <div class="mega-content">
        <div class="mega-grid" style="grid-template-columns: repeat(4, 1fr);">
          <!-- Columna 1 -->
          <div class="mega-section">
            <h3 class="mega-title"><i class="fas fa-home"></i> HOGAR & DECORACIÓN</h3>
            <ul class="mega-list">
              <li><a [routerLink]="['/products']" [queryParams]="{categoria: 'decoracion'}">Decoración</a></li>
              <li><a [routerLink]="['/products']" [queryParams]="{categoria: 'electromenor'}">Electromenor</a></li>
              <li><a [routerLink]="['/products']" [queryParams]="{categoria: 'cocina'}">Cocina</a></li>
              <li><a [routerLink]="['/products']" [queryParams]="{categoria: 'organizacion-hogar'}">Organización del
                  hogar</a></li>
            </ul>
          </div>

          <!-- Columna 2 -->
          <div class="mega-section">
            <h3 class="mega-title"><i class="fas fa-spa"></i> PERSONAL & BIENESTAR</h3>
            <ul class="mega-list">
              <li><a [routerLink]="['/products']" [queryParams]="{categoria: 'aseo-personal'}">Aseo personal</a></li>
              <li><a [routerLink]="['/products']" [queryParams]="{categoria: 'cosmeticos'}">Cosméticos</a></li>
              <li><a [routerLink]="['/products']" [queryParams]="{categoria: 'accesorios-cabello'}">Accesorios de
                  cabello</a></li>
              <li><a [routerLink]="['/products']" [queryParams]="{categoria: 'utiles-aseo'}">Útiles de aseo</a></li>
            </ul>
          </div>

          <!-- Columna 3 -->
          <div class="mega-section">
            <h3 class="mega-title"><i class="fas fa-tshirt"></i> MODA & ACCESORIOS</h3>
            <ul class="mega-list">
              <li><a [routerLink]="['/products']" [queryParams]="{categoria: 'accesorios-moda'}">Accesorios de moda</a>
              </li>
              <li><a [routerLink]="['/products']" [queryParams]="{categoria: 'bisuteria'}">Bisutería</a></li>
              <li><a [routerLink]="['/products']" [queryParams]="{categoria: 'bolsos'}">Bolsos</a></li>
              <li><a [routerLink]="['/products']" [queryParams]="{categoria: 'relojes'}">Relojes</a></li>
            </ul>
          </div>

          <!-- Columna 4 -->
          <div class="mega-section">
            <h3 class="mega-title"><i class="fas fa-dumbbell"></i> DEPORTES & GYM</h3>
            <ul class="mega-list">
              <li><a [routerLink]="['/products']" [queryParams]="{categoria: 'articulos-deportivos'}">Artículos
                  deportivos</a></li>
              <li><a [routerLink]="['/products']" [queryParams]="{categoria: 'gimnasio'}">Gimnasio</a></li>
            </ul>
          </div>
        </div>
      </div>
    </div>

    <!-- MEGA 3: Creatividad & Regalos -->
    <div class="mega-menu" [class.active]="megaMenu() === 'creatividad'">
      <div class="mega-content">
        <div class="mega-grid" style="grid-template-columns: repeat(3, 1fr);">
          <!-- Columna 1 -->
          <div class="mega-section">
            <h3 class="mega-title"><i class="fas fa-paint-brush"></i> ARTE & CREATIVIDAD</h3>
            <ul class="mega-list">
              <li><a [routerLink]="['/products']" [queryParams]="{categoria: 'productos-arte'}">Productos de arte</a>
              </li>
              <li><a [routerLink]="['/products']" [queryParams]="{categoria: 'pinturas'}">Pinturas</a></li>
              <li><a [routerLink]="['/products']" [queryParams]="{categoria: 'manualidades'}">Manualidades</a></li>
              <li><a [routerLink]="['/products']" [queryParams]="{categoria: 'arquitectura'}">Arquitectura</a></li>
              <li><a [routerLink]="['/products']" [queryParams]="{categoria: 'herramientas-creativas'}">Herramientas
                  creativas</a></li>
            </ul>
          </div>

          <!-- Columna 2 -->
          <div class="mega-section">
            <h3 class="mega-title"><i class="fas fa-gift"></i> REGALOS & EVENTOS</h3>
            <ul class="mega-list">
              <li><a [routerLink]="['/products']" [queryParams]="{categoria: 'regalos'}">Regalos</a></li>
              <li><a [routerLink]="['/products']" [queryParams]="{categoria: 'fiestas'}">Fiestas</a></li>
              <li><a [routerLink]="['/products']" [queryParams]="{categoria: 'cumpleanos'}">Cumpleaños</a></li>
              <li><a [routerLink]="['/products']" [queryParams]="{categoria: 'tarjeteria'}">Tarjetería</a></li>
              <li><a [routerLink]="['/products']" [queryParams]="{categoria: 'navidad'}">Navidad</a></li>
              <li><a [routerLink]="['/products']" [queryParams]="{categoria: 'embalaje-regalos'}">Embalaje para
                  regalos</a></li>
            </ul>
          </div>

          <!-- Columna 3 -->
          <div class="mega-section">
            <h3 class="mega-title"><i class="fas fa-cookie"></i> COMIDA & SNACKS</h3>
            <ul class="mega-list">
              <li><a [routerLink]="['/products']" [queryParams]="{categoria: 'comida'}">Comida</a></li>
              <li><a [routerLink]="['/products']" [queryParams]="{categoria: 'snacks'}">Snacks</a></li>
              <li><a [routerLink]="['/products']" [queryParams]="{categoria: 'dulces'}">Dulces</a></li>
              <li><a [routerLink]="['/products']" [queryParams]="{categoria: 'alimentos'}">Alimentos</a></li>
            </ul>
          </div>
        </div>
      </div>
    </div>
  </div>



</header>

<!-- Menú Móvil -->
<nav class="mobile-menu" [class.active]="isMobileMenuOpen()">
  <div class="mobile-menu-header">
    <div class="mobile-user">
      <i class="fas fa-user-circle"></i>
      <div *ngIf="auth.user(); else mobileGuest">
        <p class="welcome">Hola, {{ auth.user()!.nombres }}</p>
        <p class="store-name">Santiago Papelería</p>
      </div>
      <ng-template #mobileGuest>
        <p class="store-name">Santiago Papelería</p>
      </ng-template>
    </div>
    <button class="mobile-close" (click)="closeMobileMenu()" aria-label="Cerrar menú">
      <i class="fas fa-times"></i>
    </button>
  </div>

  <div class="mobile-menu-content">
    <div class="mobile-search">
      <input type="text" [(ngModel)]="searchQuery" placeholder="Buscar productos..." class="mobile-search-input">
      <button class="mobile-search-btn" (click)="performSearch()"><i class="fas fa-search"></i></button>
    </div>

    <ul class="mobile-nav">
      <li><a [routerLink]="['/']" (click)="closeMobileMenu()" class="mobile-nav-link active"><i class="fas fa-home"></i>
          Inicio</a></li>

      <!-- MOBILE PAPELERÍA -->
      <li class="mobile-category-parent" [class.open]="mobileCatOpen === 'papeleria'">
        <a (click)="mobileCatOpen = mobileCatOpen === 'papeleria' ? '' : 'papeleria'" class="mobile-nav-link">
          <i class="fas fa-pen-nib"></i> Papelería & Oficina
          <i class="fas fa-chevron-down mobile-arrow"></i>
        </a>
        <ul class="mobile-submenu" [style.display]="mobileCatOpen === 'papeleria' ? 'block' : 'none'">
          <li><a [routerLink]="['/products']" [queryParams]="{categoria: 'utiles-escolares'}"
              (click)="closeMobileMenu()">Útiles Escolares</a></li>
          <li><a [routerLink]="['/products']" [queryParams]="{categoria: 'cuadernos'}"
              (click)="closeMobileMenu()">Cuadernos</a></li>
          <li><a [routerLink]="['/products']" [queryParams]="{categoria: 'suministros-oficina'}"
              (click)="closeMobileMenu()">Oficina</a></li>
          <li><a [routerLink]="['/products']" [queryParams]="{categoria: 'calculadoras'}"
              (click)="closeMobileMenu()">Tecnología</a></li>
          <li><a [routerLink]="['/products']" [queryParams]="{categoria: 'papel-bond'}"
              (click)="closeMobileMenu()">Papeles</a></li>
        </ul>
      </li>

      <!-- MOBILE HOGAR -->
      <li class="mobile-category-parent" [class.open]="mobileCatOpen === 'hogar'">
        <a (click)="mobileCatOpen = mobileCatOpen === 'hogar' ? '' : 'hogar'" class="mobile-nav-link">
          <i class="fas fa-store"></i> Hogar & Lifestyle
          <i class="fas fa-chevron-down mobile-arrow"></i>
        </a>
        <ul class="mobile-submenu" [style.display]="mobileCatOpen === 'hogar' ? 'block' : 'none'">
          <li><a [routerLink]="['/products']" [queryParams]="{categoria: 'decoracion'}"
              (click)="closeMobileMenu()">Decoración</a></li>
          <li><a [routerLink]="['/products']" [queryParams]="{categoria: 'aseo-personal'}"
              (click)="closeMobileMenu()">Personal</a></li>
          <li><a [routerLink]="['/products']" [queryParams]="{categoria: 'moda-accesorios'}"
              (click)="closeMobileMenu()">Moda</a></li>
          <li><a [routerLink]="['/products']" [queryParams]="{categoria: 'articulos-deportivos'}"
              (click)="closeMobileMenu()">Deportes</a></li>
        </ul>
      </li>

      <!-- MOBILE CREATIVIDAD -->
      <li class="mobile-category-parent" [class.open]="mobileCatOpen === 'creatividad'">
        <a (click)="mobileCatOpen = mobileCatOpen === 'creatividad' ? '' : 'creatividad'" class="mobile-nav-link">
          <i class="fas fa-palette"></i> Creatividad & Regalos
          <i class="fas fa-chevron-down mobile-arrow"></i>
        </a>
        <ul class="mobile-submenu" [style.display]="mobileCatOpen === 'creatividad' ? 'block' : 'none'">
          <li><a [routerLink]="['/products']" [queryParams]="{categoria: 'productos-arte'}"
              (click)="closeMobileMenu()">Arte</a></li>
          <li><a [routerLink]="['/products']" [queryParams]="{categoria: 'regalos'}"
              (click)="closeMobileMenu()">Regalos</a></li>
          <li><a [routerLink]="['/products']" [queryParams]="{categoria: 'comida'}"
              (click)="closeMobileMenu()">Comida</a></li>
        </ul>
      </li>
    </ul>
  </div>
</nav>
<div class="mobile-overlay" [class.active]="isMobileMenuOpen()" (click)="closeMobileMenu()"></div>